# ============================================================================
# General Settings
# ============================================================================

# Use vi-style key bindings in copy mode
set -g mode-keys vi
set -g @shell_mode vi

# Enable mouse support for scrolling and pane selection
set -g mouse on

# Allow programs to detect focus events
set -g focus-events on

# Set terminal to support 256 colors
set -g default-terminal "tmux-256color"

# Enable true color (24-bit) support for all terminals
set -ga terminal-overrides ",*256col*:Tc"

# Enable true color support specifically for Ghostty terminal
set -ga terminal-overrides ",xterm-ghostty:Tc"

# Set scrollback buffer size to 30,000 lines
set -g history-limit 30000

# Allow applications to use terminal escape sequences (security consideration: disable if not needed)
set -g allow-passthrough on

# Start window numbering at 1 instead of 0 (easier to reach on keyboard)
set -g base-index 1

# Start pane numbering at 1 instead of 0
set -g pane-base-index 1

# ============================================================================
# Colors & Status Bar
# ============================================================================

# Set status bar background to dark gray
set -g status-bg colour236

# Set status bar text to white
set -g status-fg white

# Highlight current window in green and bold
set -g window-status-current-style 'fg=colour2 bold'

# Show hostname on the right side of status bar in gray
set -g status-right "#[fg=#999999]#(hostname)"

# ============================================================================
# macOS Integration
# ============================================================================

# Use reattach-to-user-namespace to access macOS clipboard
set -g default-command "reattach-to-user-namespace -l ${SHELL}"

# Vi-style visual selection in copy mode
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection

# Copy to macOS clipboard with 'y' in copy mode
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel 'reattach-to-user-namespace pbcopy'

# Paste from tmux buffer with prefix + p
bind-key p paste-buffer

# ============================================================================
# Key Bindings
# ============================================================================

# Change prefix from C-b to C-z (easier to reach)
set -g prefix C-z

# Reduce escape time for faster key response (10ms recommended for vim users)
set -s escape-time 10

# Reload config file with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded config !!"

# Unbind default keys that we're replacing
unbind-key C-b
unbind-key %
unbind-key '"'

# Allow C-z C-z to send C-z to the terminal
bind-key C-z send-prefix

# Split panes intuitively: | for vertical split, - for horizontal split
bind-key - split-window -v
bind-key | split-window -h

# Resize panes with vim-style keys (repeatable with -r flag)
bind-key -r H resize-pane -L 2
bind-key -r J resize-pane -D 2
bind-key -r K resize-pane -U 2
bind-key -r L resize-pane -R 2

# Display pane numbers with prefix + i
bind-key i display-panes

# Kill pane with confirmation (prefix + k)
bind-key k confirm-before 'kill-pane'
