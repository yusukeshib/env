# ============================================================================
# General Settings
# ============================================================================

# Use vi-style key bindings in copy mode
set -g mode-keys vi
set -g @shell_mode vi

# Enable mouse support for scrolling and pane selection
set -g mouse on

# Allow programs to detect focus events
set -g focus-events on

# Set terminal to support 256 colors
set -g default-terminal "tmux-256color"

# Enable true color (24-bit) support for all terminals
set -ga terminal-overrides ",*256col*:Tc"

# Enable true color support specifically for Ghostty terminal
set -ga terminal-overrides ",xterm-ghostty:Tc"

# Set scrollback buffer size to 30,000 lines
set -g history-limit 30000

# Start window numbering at 1 instead of 0 (easier to reach on keyboard)
set -g base-index 1

# Start pane numbering at 1 instead of 0
set -g pane-base-index 1

# ============================================================================
# Colors & Status Bar
# ============================================================================

# Set status bar background to dark gray
set -g status-bg colour236

# Set status bar text to white
set -g status-fg white

# Highlight current window in green and bold
set -g window-status-current-style 'fg=colour2 bold'

# Show hostname on the right side of status bar with CPU usage
set -g status-right '#{prefix_highlight} #{cpu_percentage} #[fg=#999999]%a %Y-%m-%d %H:%M #(hostname)'
set -g status-right-length 80

# ============================================================================
# Activity Monitoring
# ============================================================================

# Monitor for activity in other windows
set -g monitor-activity on

# Don't show popup message when activity occurs (just highlight in status bar)
set -g visual-activity off

# Highlight windows with activity in yellow and bold
set -g window-status-activity-style 'fg=colour3 bold'

# Monitor for bells in other windows
set -g monitor-bell on

# Don't show visual flash when bell occurs
set -g visual-bell off

# Highlight windows with bells in red and bold
set -g window-status-bell-style 'fg=colour1 bold'

# ============================================================================
# macOS Integration
# ============================================================================

# Vi-style visual selection in copy mode
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection

# Vi-style yank (copy) in copy mode
bind-key -T copy-mode-vi 'y' send-keys -X copy-selection-and-cancel

# Paste from tmux buffer with prefix + p
bind-key p paste-buffer

# ============================================================================
# Key Bindings
# ============================================================================

# Change prefix from C-b to C-z (easier to reach)
set -g prefix C-z

# Reduce escape time for faster key response (10ms recommended for vim users)
set -s escape-time 10

# Reload config file with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded config !!"

# Unbind default keys that we're replacing
unbind-key C-b
unbind-key %
unbind-key '"'

# Allow C-z C-z to send C-z to the terminal
bind-key C-z send-prefix

# Split panes intuitively: | for vertical split, - for horizontal split
bind-key - split-window -v
bind-key | split-window -h

# Resize panes with vim-style keys (repeatable with -r flag)
bind-key -r H resize-pane -L 2
bind-key -r J resize-pane -D 2
bind-key -r K resize-pane -U 2
bind-key -r L resize-pane -R 2

# Display pane numbers with prefix + i
bind-key i display-panes

# Kill pane with confirmation (prefix + k)
bind-key k confirm-before 'kill-pane'

# ============================================================================
# Plugins (TPM)
# ============================================================================

# TPM plugin manager
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Clipboard integration
set -g @plugin 'tmux-plugins/tmux-yank'

# Show prefix key press status
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# CPU and RAM monitoring
set -g @plugin 'tmux-plugins/tmux-cpu'

# ============================================================================
# Plugin Settings
# ============================================================================

# CPU plugin color settings
set -g @cpu_low_fg_color 'colour2'        # Green for low usage (< 30%)
set -g @cpu_medium_fg_color 'colour3'    # Yellow for medium usage (30-80%)
set -g @cpu_high_fg_color 'colour1'      # Red for high usage (> 80%)
set -g @cpu_low_thresh '30'
set -g @cpu_medium_thresh '50'
set -g @cpu_high_thresh '80'

# Auto-install TPM if not present
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
